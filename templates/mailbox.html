<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ (mailbox.name or mailbox.nickname) }}ë‹˜ì˜ ìš°ì²´í†µ</title>
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        .postcard {
            background: white;
            padding: 30px;
            margin: 20px 0;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            position: relative;
            border: 2px solid transparent;
            overflow: hidden;
        }
        .template-postcard-sunset { background: linear-gradient(135deg, #f6d365 0%, #fda085 100%); }
        .template-postcard-ocean { background: linear-gradient(135deg, #48c6ef 0%, #6f86d6 100%); }
        .template-postcard-midnight { background: linear-gradient(135deg, #141e30 0%, #243b55 100%); color: #f8fafc; }
        .template-stationery-cream { background: linear-gradient(135deg, #fdfcfb 0%, #e2d1c3 100%); }
        .template-stationery-olive { background: linear-gradient(135deg, #d2fbd4 0%, #88c397 100%); }
        .template-stationery-lilac { background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%); }
        .postcard::before {
            content: "";
            position: absolute;
            inset: 12px;
            border-radius: 12px;
            background: white;
            opacity: 0.9;
            z-index: 0;
        }
        .postcard > * { position: relative; z-index: 1; }
        .template-badge {
            display: inline-block;
            padding: 6px 10px;
            border-radius: 999px;
            background: rgba(0,0,0,0.08);
            color: #111827;
            font-weight: 700;
            font-size: 12px;
            margin-bottom: 10px;
        }
        .anon-badge {
            display: inline-block;
            padding: 6px 10px;
            border-radius: 999px;
            background: rgba(67, 56, 202, 0.12);
            color: #312e81;
            font-weight: 700;
            font-size: 12px;
            margin-left: 8px;
        }
        @font-face {
            font-family: 'PyeojinGothic';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/2504-1@1.0/PyeojinGothic-Regular.woff2') format('woff2');
            font-weight: 400;
            font-display: swap;
        }
        @font-face {
            font-family: 'KimJeongcheolMyoungjo';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2302_01@1.0/KimjungchulMyungjo-Light.woff2') format('woff2');
            font-weight: 300;
            font-display: swap;
        }
        @font-face {
            font-family: 'YesMyungjo';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_13@1.0/YESMyoungjo-Regular.woff') format('woff');
            font-weight: normal;
            font-display: swap;
        }
        @font-face {
            font-family: 'YesMyungjo';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_13@1.0/YESMyoungjo-Bold.woff') format('woff');
            font-weight: 700;
            font-display: swap;
        }
        .verse-reference {
            color: #667eea;
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
        }
        .template-postcard-midnight .verse-reference {
            color: #c7d2fe;
        }
        .verse-text {
            font-size: 16px;
            line-height: 1.6;
            margin: 15px 0;
            padding: 15px;
            background: #f5f5f5;
            border-left: 4px solid #667eea;
        }
        .template-postcard-midnight .verse-text {
            background: rgba(255,255,255,0.08);
            color: #e5e7eb;
        }
        .message {
            margin-top: 15px;
            padding: 15px;
            background: #fff9e6;
            border-radius: 10px;
        }
        .empty-state {
            text-align: center;
            padding: 50px;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        {% set display_name = mailbox.name or mailbox.nickname %}
        <h1>ğŸ‰ {{ display_name }}ë‹˜ì—ê²Œ ì˜¨ ì—½ì„œë“¤</h1>

        {% if mailbox.prayer_topic %}
        <div class="postcard" style="background: #eef2ff;">
            <div class="verse-reference">ğŸ™ í•¨ê»˜ ê¸°ë„í•´ìš”</div>
            <div class="verse-text" style="background: white;">{{ mailbox.prayer_topic }}</div>
        </div>
        {% endif %}
        
        {% if postcards %}
            {% for postcard in postcards %}
            {% set tpl_id = postcard.template_id or 'default' %}
            {% set tpl_type = postcard.template_type or 'ì—½ì„œ' %}
            {% set font_family = postcard.font_family or postcard.font_style %}
            <div class="postcard template-{{ tpl_id }}">
                <div class="template-badge">{{ tpl_type }} | {{ postcard.template_name or tpl_id }}</div>
                {% if postcard.is_anonymous %}
                <span class="anon-badge">ìµëª…</span>
                {% endif %}
                <div class="verse-reference">ğŸ“– {{ postcard.verse_reference }}</div>
                <div class="verse-text" style="{{ 'font-family: ' ~ font_family ~ ';' if font_family else '' }}">{{ postcard.verse_text }}</div>
                {% if postcard.message %}
                <div class="message" style="{{ 'font-family: ' ~ font_family ~ ';' if font_family else '' }}">
                    <strong>ğŸ’Œ í¸ì§€:</strong><br>
                    {{ postcard.message }}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <h2>ğŸ“­ ì•„ì§ ë°›ì€ ì—½ì„œê°€ ì—†ìŠµë‹ˆë‹¤</h2>
                <p>ì¹œêµ¬ë“¤ì—ê²Œ ë§í¬ë¥¼ ê³µìœ í•´ë³´ì„¸ìš”!</p>
            </div>
        {% endif %}
    </div>
</body>
</html>
