{% extends 'base.html' %}

{% block content %}
<div class="flex-1 flex flex-col items-center justify-center px-6 py-12 max-w-2xl mx-auto w-full">

    <div class="w-full bg-slate-200 dark:bg-slate-800 h-1.5 rounded-full mb-12 overflow-hidden">
        <div id="progress-bar" class="bg-primary dark:bg-accent h-full transition-all duration-500"
            style="width: 33.3%"></div>
    </div>

    <section id="step-1" class="w-full animate-fade-in">
        <h2 class="text-2xl font-bold font-serif mb-2 dark:text-white">1. 우체통 디자인 선택</h2>
        <p class="text-slate-500 mb-8">마음에 드는 우체통 스타일을 골라보세요.</p>

        <div class="grid grid-cols-2 gap-4">
            <div onclick="selectDesign('classic','/static/images/postbox/yellow_postboxes.png')"
                class="design-card border-4 border-primary p-4 rounded-2xl cursor-pointer bg-white dark:bg-slate-800 shadow-sm hover:shadow-md transition-all">
                <div class="h-24 bg-primary/20 rounded-xl mb-3 flex items-center justify-center text-3xl">📮</div>
                <p class="text-center font-medium dark:text-white text-sm">클래식 레드</p>
            </div>
            <div onclick="selectDesign('night','')"
                class="design-card border-4 border-transparent p-4 rounded-2xl cursor-pointer bg-white dark:bg-slate-800 shadow-sm hover:shadow-md transition-all">
                <div class="h-24 bg-blue-900/20 rounded-xl mb-3 flex items-center justify-center text-3xl">🌌</div>
                <p class="text-center font-medium dark:text-white text-sm">심야의 별빛</p>
            </div>
        </div>

        <button onclick="nextStep(2)" class="w-full py-4 bg-primary text-white rounded-xl mt-10 font-bold">다음으로</button>
    </section>

    <section id="step-2" class="w-full hidden animate-fade-in">
        <h2 class="text-2xl font-bold font-serif mb-2 dark:text-white">2. 메시지 공개 설정</h2>
        <p class="text-slate-500 mb-8">도착한 편지를 다른 사람도 볼 수 있게 할까요?</p>

        <div class="space-y-4">
            <label
                class="flex items-center p-5 bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 cursor-pointer hover:bg-slate-50">
                <input type="radio" name="privacy" value="public" checked class="w-5 h-5 text-primary">
                <div class="ml-4">
                    <p class="font-bold dark:text-white">모두에게 공개</p>
                    <p class="text-sm text-slate-500">누구나 내 우체통의 편지를 읽을 수 있습니다.</p>
                </div>
            </label>
            <label
                class="flex items-center p-5 bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 cursor-pointer hover:bg-slate-50">
                <input type="radio" name="privacy" value="private" class="w-5 h-5 text-primary">
                <div class="ml-4">
                    <p class="font-bold dark:text-white">나만 보기 (비공개)</p>
                    <p class="text-sm text-slate-500">우체통 주인인 나만 편지를 확인할 수 있습니다.</p>
                </div>
            </label>
        </div>

        <div class="flex gap-3 mt-10">
            <button onclick="nextStep(1)"
                class="flex-1 py-4 bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-white rounded-xl font-bold">이전</button>
            <button onclick="nextStep(3)" class="flex-[2] py-4 bg-primary text-white rounded-xl font-bold">우체통
                만들기</button>
        </div>
    </section>

    <section id="step-3" class="w-full hidden animate-fade-in text-center">
        <div class="mb-6 text-5xl">🎉</div>
        <h2 class="text-2xl font-bold font-serif mb-2 dark:text-white">우체통이 준비되었습니다!</h2>
        <p class="text-slate-500 mb-8">이제 링크를 공유해 친구들에게 편지를 받아보세요.</p>

        <div
            class="flex items-center gap-2 p-2 bg-slate-100 dark:bg-slate-900 rounded-xl mb-8 border border-slate-200 dark:border-slate-800">
            <input id="share-url" type="text" readonly value="https://letter.com/mailbox/{{ user_name }}"
                class="flex-1 bg-transparent px-2 text-sm dark:text-white outline-none">
            <button onclick="copyLink()"
                class="px-4 py-2 bg-white dark:bg-slate-800 rounded-lg text-xs font-bold shadow-sm">복사</button>
        </div>

        <div class="grid grid-cols-1 gap-4">
            <button onclick="downloadIGImage()"
                class="flex items-center justify-center gap-2 w-full py-4 bg-gradient-to-tr from-[#f09433] via-[#e6683c] to-[#bc1888] text-white rounded-xl font-bold shadow-lg">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                    <path
                        d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.355 2.618 6.778 6.98 6.978 1.28.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z" />
                </svg>
                스토리 공유 이미지 저장
            </button>
            <a href="/" class="text-sm text-slate-400 hover:underline">홈으로 이동</a>
        </div>
    </section>
</div>

<script>
    let currentStep = 1;
    let selectedDesignId = 'classic'; // 현재 선택된 디자인 ID 저장

    function nextStep(step) {
        document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
        document.getElementById(`step-${step}`).classList.remove('hidden');

        // 프로그레스 바 업데이트
        const progress = (step / 3) * 100;
        document.getElementById('progress-bar').style.width = `${progress}%`;
    }

    function selectDesign(id, imageUrl) {
        // 1. 선택된 디자인 ID 저장
        selectedDesignId = id;

        // 2. 미리보기 이미지 변경 (부드러운 전환 효과)
        const previewImage = document.getElementById('preview-image');
        previewImage.style.opacity = '0'; // 일단 투명하게
        setTimeout(() => {
            previewImage.src = imageUrl; // 이미지 경로 교체
            previewImage.style.opacity = '1'; // 다시 보이게
        }, 150); // 짧은 딜레이로 깜빡임 효과

        // 3. 카드 스타일 업데이트 (선택된 카드만 테두리 강조)
        document.querySelectorAll('.design-card').forEach(card => {
            card.classList.replace('border-primary', 'border-transparent');
        });
        event.currentTarget.classList.replace('border-transparent', 'border-primary');
    }

    function copyLink() {
        const copyText = document.getElementById("share-url");
        copyText.select();
        document.execCommand("copy");
        alert("링크가 복사되었습니다!");
    }

    function downloadIGImage() {
        alert("인스타그램 스토리용 이미지를 생성 중입니다... (잠시만 기다려주세요)");
        // 여기에 나중에 HTML5 Canvas를 이용한 이미지 생성 로직을 넣을 수 있습니다.
    }
</script>
{% endblock %}