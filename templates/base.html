<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta property="og:type" content="website">
    <meta property="og:title" content="{{ og_title | default('ë§ì”€ìš°ì²´í†µ') }}">
    <meta property="og:description" content="{{ og_description | default('ì†Œì¤‘í•œ ë§ˆìŒì„ í¸ì§€ì— ë‹´ì•„ ì „ë‹¬í•´ì£¼ì„¸ìš”.') }}">
    <meta property="og:image" content="{{ og_image | default('/static/images/default_og.png') }}">
    <meta property="og:url" content="{{ request.url }}">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ og_title | default('ë§ì”€ìš°ì²´í†µ') }}">
    <meta name="twitter:image" content="{{ og_image | default('/static/images/default_og.png') }}">

    <title>{{ og_title | default('ë§ì”€ìš°ì²´í†µ') }}</title>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        accent: '#fbbf24',
                    },
                    keyframes: {
                        twinkle: {
                            '0%, 100%': { opacity: 0.3, transform: 'scale(1)' },
                            '50%': { opacity: 1, transform: 'scale(1.2)' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-15px)' },
                        },
                        'fade-in-up': {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    },
                    animation: {
                        twinkle: 'twinkle 3s ease-in-out infinite',
                        float: 'float 5s ease-in-out infinite',
                        'fade-in-up': 'fade-in-up 0.6s ease-out forwards',
                    }
                }
            }
        }
    </script>
    <script>
        // Supabase Client Initialization
        const supabaseUrl = "{{ supabase_url }}";
        const supabaseKey = "{{ supabase_key }}";
        window.supabaseApp = null;

        if (supabaseUrl && supabaseKey && window.supabase) {
            window.supabaseApp = window.supabase.createClient(supabaseUrl, supabaseKey);
            console.log("Supabase Initialized:", !!window.supabaseApp);
        }

        // Global Helper: Get Redirect Base URL
        function getRedirectBase() {
            const origin = window.location.origin;
            const host = window.location.hostname;
            const allowedHosts = new Set([
                '127.0.0.1',
                'localhost',
                'bible-agent-497880616364.asia-northeast3.run.app',
                'bible-postoffice-2025.web.app',
            ]);
            if (allowedHosts.has(host) || host.includes('run.app')) {
                return origin;
            }
            return "https://bible-postoffice-2025.web.app";
        }

        // Global Logout Handler (Syncs Supabase & Flask)
        async function handleGlobalLogout() {
            try {
                if (window.supabaseApp) {
                    await window.supabaseApp.auth.signOut();
                }
            } catch (err) {
                console.warn("Supabase SignOut Error:", err);
            } finally {
                window.location.href = '/logout';
            }
        }
    </script>
    <style type="text/tailwindcss">
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&display=swap');
        
        @layer base {
            .font-serif { font-family: 'Noto Serif KR', serif; }
            /* í…ìŠ¤íŠ¸ê°€ ì•ˆ ë³´ì´ëŠ” í˜„ìƒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ê¸°ë³¸ í…ìŠ¤íŠ¸ ìƒ‰ìƒì„ ê°•ì œ ì§€ì • */
            body {
                @apply bg-slate-50 text-slate-900 dark:bg-slate-950 dark:text-slate-50 transition-colors duration-500 min-h-screen flex flex-col;
            }
        }
    </style>
</head>

<body class="font-serif">

    <nav class="fixed top-0 left-0 right-0 z-50 flex justify-between items-center px-6 py-4 bg-transparent border-none">
        <a href="/" class="flex items-center gap-2 group">
            <div
                class="w-10 h-10 rounded-xl flex items-center justify-center shadow-lg group-hover:rotate-12 transition-transform">
                <span class="text-white text-xl">âœ‰ï¸</span>
            </div>
        </a>

        <div class="flex items-center gap-2">
            {% if is_logged_in %}
            <button onclick="handleGlobalLogout()"
                class="px-4 py-2 bg-slate-100/80 hover:bg-slate-200 dark:bg-slate-800/80 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 rounded-xl transition-all text-sm font-bold active:scale-95">
                ë¡œê·¸ì•„ì›ƒ
            </button>
            {% endif %}

            <button id="theme-toggle"
                class="p-2.5 rounded-xl transition-all hover:bg-slate-200/50 dark:hover:bg-slate-800/50 active:scale-95">
                <span id="theme-toggle-light-icon" class="hidden dark:block text-xl">â˜€ï¸</span>
                <span id="theme-toggle-dark-icon" class="block dark:hidden text-xl text-slate-700">ğŸŒ™</span>
            </button>
        </div>
    </nav>

    <main class="flex-1 flex flex-col pt-24 px-4">
        {% block content %}
        <div
            class="max-w-2xl mx-auto w-full p-8 rounded-3xl bg-white dark:bg-slate-900 shadow-xl border border-slate-100 dark:border-slate-800">
            <h1 class="text-3xl font-bold mb-4">ë°˜ê°‘ìŠµë‹ˆë‹¤!</h1>
            <p class="leading-relaxed opacity-90">
                ë¼ì´íŠ¸ëª¨ë“œì—ì„œëŠ” ì–´ë‘ìš´ ê¸€ì”¨ë¡œ, ë‹¤í¬ëª¨ë“œì—ì„œëŠ” ë°ì€ ê¸€ì”¨ë¡œ ìë™ ì „í™˜ë©ë‹ˆë‹¤.
                ë°°ê²½ìƒ‰ê³¼ ê¸€ììƒ‰ì˜ ëŒ€ë¹„ë¥¼ ë†’ì—¬ ì‹œì¸ì„±ì„ í™•ë³´í–ˆìŠµë‹ˆë‹¤.
            </p>
        </div>
        {% endblock %}
    </main>

    <script>
        const themeToggleBtn = document.getElementById('theme-toggle');

        // ì´ˆê¸° í…Œë§ˆ ì„¤ì • í™•ì¸ í•¨ìˆ˜
        function initTheme() {
            if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }

        themeToggleBtn.addEventListener('click', function () {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.theme = 'light';
            } else {
                document.documentElement.classList.add('dark');
                localStorage.theme = 'dark';
            }
        });

        initTheme();
    </script>
</body>

</html>